generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Description {
  id                   Int                    @id(map: "Descriptions_pk") @unique(map: "Descriptions_description_id_key") @default(autoincrement())
  text                 String
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Product              Product[]
}

enum DocumentTypeEnum {
  IMAGE
  FILE
}

model Document {
  id                   Int                    @id(map: "Documents_pk") @unique(map: "Documents_image_id_key") @default(autoincrement())
  url                  String
  type                 DocumentTypeEnum       @default(IMAGE)
  name                 String
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Cart                 Cart[]
  CategoryDocument     CategoryDocument[]
  User                 User[]
  ProductDocument      ProductDocument[]
}

model Product {
  id                   Int                    @id(map: "Products_pk") @unique(map: "Products_product_id_key") @default(autoincrement())
  name                 String
  description_id       Int?
  category_id          Int?
  description          String?
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Description          Description?           @relation(fields: [description_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_description_id_fk")
  CartProduct          CartProduct[]
  Category             Category?              @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "product_category_id_fk")
  ProductDocument      ProductDocument[]
}

model ProductDocument {
  product_id           Int
  document_id          Int
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Product              Product                @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "model_product_id_fk")
  Document             Document               @relation(fields: [document_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "model_document_id_fk")

  @@id([product_id, document_id])
}

model Supplier {
  id                                    Int                    @id(map: "Suppliers_pk") @unique(map: "Suppliers_supplier_id_key") @default(autoincrement())
  name                                  String
  deliver_goods_yourself                Boolean                @default(false)
  array_of_delivery_ids                 Int[]                  @default([])
  created_at                            DateTime               @default(now())
  updated_at                            DateTime               @updatedAt
  deleted_at                            DateTime?

  CartProduct          CartProduct[]
  User                 User?
  Address              Address[]
}

enum DeliveryTypeEnum {
  USER
  SUPPLIER
}

model Delivery {
  id                              Int                    @id @default(autoincrement())
  name                            String                 @unique
  type                            DeliveryTypeEnum
  parent_id                       Int?
  created_at                      DateTime               @default(now())
  updated_at                      DateTime               @updatedAt
  deleted_at                      DateTime?

  Children                        Delivery[]             @relation(name: "DeliveryToDelivery")
  Parent                          Delivery?              @relation(name: "DeliveryToDelivery", fields: [parent_id], references: [id])
}

enum CartType {
  CART
  PRODUCT_WATCHLIST
  SUPPLIER_WATCHLIST
}

model Cart {
  id                                    Int                    @id @default(autoincrement())
  document_id                           Int?
  cloth_sex                             ClothSexEnum
  category_id                           Int?
  custom_size                           String?                @db.VarChar(1024)
  custom_model                          String?                @db.VarChar(1024)
  custom_knot                           String?                @db.VarChar(1024)
  custom_textile                        String?                @db.VarChar(1024)
  additional_materials                  String?                @db.VarChar(1024)
  artistic_description                  String?                @db.VarChar(1024)
  created_at                            DateTime               @default(now())
  updated_at                            DateTime               @updatedAt
  deleted_at                            DateTime?

  Category                              Category?              @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "category_id")
  CartProducts                          CartProduct[]
  CartSize                              CartSize[]
  Document                              Document?              @relation(fields: [document_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "model_document_id_fk")
}

model CartProduct {
  id                   Int                    @id @default(autoincrement())
  cart_id              Int
  product_id           Int?
  quantity             Int                    @default(1)
  supplier_id          Int?
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Cart                 Cart                   @relation(fields: [cart_id], references: [id])
  Product              Product?               @relation(fields: [product_id], references: [id])
  Supplier             Supplier?              @relation(fields: [supplier_id], references: [id])

  @@unique([cart_id, product_id])
}

model Category {
  id                           Int                           @id @default(autoincrement())
  name                         String
  parent_id                    Int?
  mannequin                    MannequinPositionEnum?
  sex                          ClothSexEnum?
  description                  String?
  created_at                   DateTime                      @default(now())
  updated_at                   DateTime                      @updatedAt
  deleted_at                   DateTime?

  Children                     Category[]                    @relation(name: "CategoryToCategory")
  Parent                       Category?                     @relation(name: "CategoryToCategory", fields: [parent_id], references: [id])
  Cart                         Cart[]
  Product                      Product[]
  CategoryDocument             CategoryDocument[]
}

model CategoryDocument {
  id                           Int                           @id @default(autoincrement())
  category_id                  Int
  document_id                  Int
  type                         DocumentTypeOfCategoryEnum
  created_at                   DateTime                      @default(now())
  updated_at                   DateTime                      @updatedAt
  deleted_at                   DateTime?

  Category                     Category                      @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "category_id")
  Document                     Document                      @relation(fields: [document_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "model_document_id_fk")

  @@unique([category_id, type])
}

enum DocumentTypeOfCategoryEnum {
  MANNEQUIN
  PREVIEW
}

enum MannequinPositionEnum {
  UP
  DOWN
  FULL
}

enum UserTypeEnum {
  USER
  GUEST
}

model User {
  id                       Int                    @id(map: "user_pk") @unique(map: "user_id_uindex") @default(autoincrement())
  name                     String
  user_name                String?                @unique
  email                    String                 @unique(map: "user_email_uindex")
  password                 String?
  type                     UserTypeEnum           @default(USER)
  document_id              Int?                   @unique
  supplier_id              Int?                   @unique
  array_of_delivery_ids    Int[]                  @default([])
  created_at               DateTime               @default(now())
  updated_at               DateTime               @updatedAt
  deleted_at               DateTime?

  Supplier                 Supplier?              @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "supplier_id")
  Profile                  Profile?
  UserRole                 UserRole[]
  Address                  Address[]
  Document                 Document?              @relation(fields: [document_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "model_document_id_fk")
}

model Address {
  id                             Int                    @id(map: "address_pk") @unique(map: "address_id_uindex") @default(autoincrement())
  user_id                        Int
  supplier_id                    Int?
  type                           AddressType            @default(DELIVERY)
  name                           String
  postcode                       Int?
  country                        String
  region                         String
  city                           String
  street                         String
  house_number                   Int
  apartment_number_or_office     Int?
  created_at                     DateTime               @default(now())
  updated_at                     DateTime               @updatedAt
  deleted_at                     DateTime?

  User                           User                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_id")
  Supplier                       Supplier?              @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "supplier_id")
}

enum AddressType {
  DELIVERY
  WAREHOUSE
}

model Profile {
  id                   Int                    @id @default(autoincrement())
  user_id              Int                    @unique
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  User                 User                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_id")
}

model UserRole {
  id                   Int                    @id @default(autoincrement())
  user_id              Int
  role_name            RolesEnum              @default(USER)
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  User                 User                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_id")

  @@unique([user_id, role_name])
}

enum RolesEnum {
  ADMIN
  USER
}

enum ClothSexEnum {
  MALE
  FEMALE
  UNISEX
}

model Size {
  id                   Int                    @id @default(autoincrement())
  json                 Json
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  CartSize             CartSize[]
}

model CartSize {
  size_id              Int
  cart_id              Int
  created_at           DateTime               @default(now())
  updated_at           DateTime               @updatedAt
  deleted_at           DateTime?

  Cart                 Cart                   @relation(fields: [cart_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "cart_id")
  Size                 Size                   @relation(fields: [size_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "size_id")

  @@unique([cart_id, size_id])
}
